# 텔레그램 주식 봇 🤖📈

실시간 주식 정보를 텔레그램으로 조회할 수 있는 봇입니다.

## 주요 기능

### 1. 실시간 주식 정보 조회
- 개별 종목 현재가 조회
- 여러 종목 동시 조회
- 코스피/코스닥 지수 확인
- 인기 검색 종목 TOP 10

### 2. 실시간 알림 (선택 기능)
- 특정 종목 가격 변동 시 자동 알림
- 30초마다 가격 체크

### 3. CLI 명령어 실행
- 서버에서 직접 명령어 실행

## 명령어 사용법

### 📊 주식 조회
```
/stock 삼성전자
→ 삼성전자의 현재가, 등락률, 거래량 표시

/stocks 삼성전자,네이버,카카오
→ 여러 종목을 한 번에 조회

/market
→ 코스피, 코스닥 지수 확인

/popular
→ 실시간 인기 검색 종목 TOP 10

/list
→ 조회 가능한 주요 종목 리스트
```

### 🔔 실시간 알림 (선택 기능)
```
/alert 삼성전자
→ 삼성전자 가격 변동 시 자동 알림 설정

/unalert
→ 알림 해제

/mystatus
→ 현재 구독 중인 종목 확인
```

### 💻 시스템 명령어
```
/cli ls -la
→ 서버에서 CLI 명령어 실행

/help
→ 도움말 표시
```

## 설치 방법

### 1. 의존성 추가 (pom.xml)
```xml
<dependencies>
    <!-- Spring Boot Web -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
    </dependency>

    <!-- Telegram Bots -->
    <dependency>
        <groupId>org.telegram</groupId>
        <artifactId>telegrambots</artifactId>
        <version>6.8.0</version>
    </dependency>

    <!-- Jackson -->
    <dependency>
        <groupId>com.fasterxml.jackson.core</groupId>
        <artifactId>jackson-databind</artifactId>
    </dependency>
</dependencies>
```

### 2. application.properties 설정
```properties
telegram.bot.token=YOUR_BOT_TOKEN
telegram.bot.username=YOUR_BOT_USERNAME
```

### 3. 파일 구조
```
src/main/java/com/example/Tbot/
├── TbotApplication.java           # 메인 애플리케이션
├── service/
│   ├── CliService.java            # CLI 명령 실행
│   ├── StockService.java          # 주식 정보 조회
│   └── StockAlertService.java     # 실시간 알림 (선택)
└── telegram/
    ├── TbotTelegram.java          # 텔레그램 봇
    └── CommandRouter.java         # 명령어 라우팅
```

## 조회 가능한 주요 종목

- 삼성전자
- SK하이닉스
- 네이버
- 카카오
- 현대차
- LG에너지솔루션
- 셀트리온
- 삼성바이오로직스
- 포스코홀딩스
- KB금융

*더 많은 종목을 추가하려면 `StockService.java`의 `stockCodes` Map에 추가하세요.*

## 사용 예시

### 예시 1: 삼성전자 현재가 조회
```
사용자: /stock 삼성전자

봇 응답:
📊 삼성전자 (005930)

현재가: 71,500원
🔺 전일대비: +1,500원 (+2.14%)
거래량: 12,345,678주

⏰ 실시간 조회
```

### 예시 2: 여러 종목 동시 조회
```
사용자: /stocks 삼성전자,네이버,카카오

봇 응답:
📈 주식 현황

🔺 삼성전자: 71,500원 (+2.14%)
🔻 네이버: 185,000원 (-1.5%)
🔺 카카오: 52,300원 (+0.8%)
```

### 예시 3: 시장 지수 확인
```
사용자: /market

봇 응답:
📊 시장 지수

KOSPI: 2,543.21 🔺+15.32 (+0.61%)
KOSDAQ: 745.89 🔻-3.21 (-0.43%)
```

### 예시 4: 실시간 알림 설정
```
사용자: /alert 삼성전자

봇 응답:
✅ '삼성전자' 실시간 알림이 설정되었습니다.
가격 변동 시 자동으로 알림을 받습니다.

(30초 후 가격이 변동되면 자동으로 알림)
봇: 🔔 삼성전자 가격 변동

📊 삼성전자 (005930)
현재가: 72,000원
🔺 전일대비: +2,000원 (+2.85%)
...
```

## API 소스

이 봇은 네이버 금융 API를 사용하여 실시간 주식 정보를 가져옵니다.

- 실시간 시세: `https://polling.finance.naver.com/api/realtime`
- 인기 종목: `https://m.stock.naver.com/api/stocks/popular/DOMESTIC`

## 주의사항

1. **실시간 알림 기능**은 선택사항입니다. 필요 없으면 `StockAlertService`를 제거하세요.
2. **API 호출 제한**: 과도한 호출 시 IP 차단될 수 있으니 주의하세요.
3. **CLI 명령어**: 보안상 위험할 수 있으니 프로덕션 환경에서는 제한을 두세요.

## 확장 아이디어

- [ ] 종목 검색 기능 추가
- [ ] 차트 이미지 생성
- [ ] 가격 알림 임계값 설정 (예: 5% 이상 변동 시만 알림)
- [ ] 포트폴리오 관리 기능
- [ ] 뉴스 스크래핑
- [ ] 미국 주식 지원

## 라이선스

MIT License

---

# 실시간 주식 모니터링 및 알림 가이드 📊

## 🔔 두 가지 모드

### 1. 가격 변동 알림 모드 (`/alert`)
**특징:**
- 10초마다 가격 체크
- **가격이 변동될 때만** 알림 전송
- 조용한 모니터링

**사용법:**
```
/alert 삼성전자
```

**예시:**
```
사용자: /alert 삼성전자

봇: ✅ '삼성전자' 실시간 알림이 설정되었습니다.
10초마다 가격을 체크하여 변동 시 알림을 보냅니다.

현재 정보:
📊 삼성전자 (005930)
현재가: 71,500원
🔺 전일대비: +1,500원 (+2.14%)
거래량: 12,345,678주
⏰ 실시간 조회

--- 10초 후 가격 변동 시 ---

봇: 🔔 삼성전자 가격 변동 알림!

📊 삼성전자 (005930)
현재가: 71,600원
🔺 전일대비: +1,600원 (+2.29%)
거래량: 12,567,890주
⏰ 실시간 조회
```

---

### 2. 연속 모니터링 모드 (`/monitor`)
**특징:**
- 10초마다 무조건 정보 전송
- 가격 변동 여부와 관계없이 계속 업데이트
- 실시간 추적에 유용

**사용법:**
```
/monitor 삼성전자
```

**예시:**
```
사용자: /monitor 삼성전자

봇: 🔄 '삼성전자' 연속 모니터링을 시작합니다.
10초마다 최신 정보를 전송합니다.
중지하려면 /stop 입력

--- 10초마다 계속 ---

봇: 🔄 실시간 모니터링 #1
⏰ 14:23:10

📊 삼성전자 (005930)
현재가: 71,500원
🔺 전일대비: +1,500원 (+2.14%)
거래량: 12,345,678주
⏰ 실시간 조회

중지하려면 /stop 입력

--- 10초 후 ---

봇: 🔄 실시간 모니터링 #2
⏰ 14:23:20

📊 삼성전자 (005930)
현재가: 71,500원
🔺 전일대비: +1,500원 (+2.14%)
거래량: 12,345,678주
⏰ 실시간 조회

중지하려면 /stop 입력

(계속 반복...)
```

---

## 📋 명령어 모음

### 기본 조회
```
/stock 삼성전자           - 1회 조회
/stocks 삼성전자,네이버   - 여러 종목 조회
/market                   - 시장 지수
/popular                  - 인기 종목
/list                     - 조회 가능 종목
```

### 알림 설정 (가격 변동 시)
```
/alert 삼성전자           - 알림 시작
/unalert                  - 알림 중지
```

### 연속 모니터링 (10초마다)
```
/monitor 삼성전자         - 모니터링 시작
/stop                     - 모니터링 중지
```

### 상태 확인
```
/status                   - 현재 알림/모니터링 상태
```

---

## 💡 사용 시나리오

### 시나리오 1: 급등락 종목 감시
```
상황: 삼성전자가 급등락 중

사용: /alert 삼성전자
→ 가격이 변동될 때마다 알림받음
→ 조용히 지켜보다가 변동 시에만 확인
```

### 시나리오 2: 장 마감 전 집중 모니터링
```
상황: 장 마감 30분 전, 가격 추이를 계속 확인하고 싶음

사용: /monitor 삼성전자
→ 10초마다 무조건 업데이트
→ 실시간 흐름 파악
→ 장 마감 후: /stop
```

### 시나리오 3: 여러 종목 동시 감시
```
사용자 A:
/alert 삼성전자

사용자 B:
/alert 네이버

각자 자신이 설정한 종목의 변동만 알림받음
```

---

## ⚙️ 설정 변경

### 체크 주기 변경하기

**StockAlertService.java** (가격 변동 알림)
```java
// @Scheduled(fixedRate = 10000) // 10초 → 원하는 시간(밀리초)
```

**ContinuousMonitoringService.java** (연속 모니터링)
```java
// @Scheduled(fixedRate = 10000) // 10초 → 원하는 시간(밀리초)
```

**예시:**
- 5초: `fixedRate = 5000`
- 30초: `fixedRate = 30000`
- 1분: `fixedRate = 60000`

---

## 🔧 파일 구조

```
com.example.Tbot/
├── service/
│   ├── StockService.java                    # 주식 정보 조회
│   ├── StockAlertService.java              # 가격 변동 알림 ⭐
│   ├── ContinuousMonitoringService.java    # 연속 모니터링 ⭐
│   └── CliService.java                      # CLI 실행
└── telegram/
    ├── TbotTelegram.java                    # 텔레그램 봇
    └── CommandRouter.java                   # 명령어 라우팅
```

---

## 📊 로그 출력

### 콘솔 로그 예시
```
🔍 [Mon Jan 13 14:23:10 KST 2025] 주식 가격 체크 시작 - 구독자 수: 2
⏸️ 가격 변동 없음: 삼성전자
📤 알림 전송: 네이버 -> chatId: 123456789
✅ 주식 가격 체크 완료

🔄 [Mon Jan 13 14:23:10 KST 2025] 연속 모니터링 업데이트 - 모니터링 중: 1
✅ 모니터링 업데이트 전송: 카카오 (#5)
```

---

## ⚠️ 주의사항

### 1. API 호출 제한
```
10초마다 체크 → 시간당 360회 호출
네이버 금융 API는 과도한 호출 시 차단 가능
→ 필요한 경우에만 사용 권장
```

### 2. 배터리 소모
```
모바일에서 알림이 계속 오면 배터리 소모
→ 필요 없을 때는 /stop으로 중지
```

### 3. 장 마감 시간
```
평일 09:00~15:30 (한국 시간) 이외에는
가격 변동이 없음
→ 장 시작 전/후에는 /stop 권장
```

---

## 🎯 팁

### 효율적인 사용법
```
1. 평소: /alert 종목명 (가격 변동만 알림)
2. 급할 때: /monitor 종목명 (10초마다 체크)
3. 확인 후: /stop (중지)
4. 다시 시작: /alert 또는 /monitor
```

### 여러 계정 사용
```
각 텔레그램 계정마다 독립적으로 작동
chatId가 다르므로 서로 간섭 없음
```

---

## 🐛 문제 해결

### Q1: 알림이 너무 많이 와요
```
해결: /alert 대신 사용 중이라면 → 정상
     /monitor 사용 중이라면 → /stop 후 /alert 사용
```

### Q2: 알림이 안 와요
```
확인:
1. /status로 상태 확인
2. 구독/모니터링이 활성화되어 있는지 확인
3. 콘솔 로그 확인
4. 장이 열려있는 시간인지 확인 (09:00~15:30)
```

### Q3: 중지가 안돼요
```
해결: /stop 입력 (모든 알림/모니터링 중지)
```

---

## 📱 실전 예시

### 출근 전
```
/alert 삼성전자
→ 가격 변동 시 알림받기
```

### 장 마감 30분 전
```
/stop
/monitor 삼성전자
→ 집중 모니터링 시작
```

### 퇴근 후
```
/stop
→ 모든 알림 중지
```

즐거운 주식 투자 되세요! 📈🚀